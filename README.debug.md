# `debug()`

* [Author and copyright](#author-and-copyright)
* [Introduction](#introduction)
* [Installation](#installation)
* [Basic usage](#basic)
  * [Most common usage](#most-common-usage)
  * [Normal usage](#normal-usage)
  * [Simplest usage](#simplest-usage)
* [Reserved strings](#reserved-strings)
* [Advanced usage](#advanced-usage)
  * [Unlimited arguments](#unlimited-arguments)
  * [max_times](#max-times)
  * [force_die](#force-die)
* [Configuration](#configuration)
  * [Options](#options)
  * [Sample Config file](#sample-config-file)
			
-----

## Author and copyright

This script was written by Evan Wills with technical assistance and 
advice from Trevor Goodall, Brent Knigge and Ivan Wills.

It is released under the GPL2

## Introduction


`debug()` is intended make it easy to output debug messages when 
developing or debugging a PHP script.

By default it outputs to screen the original calling script's file 
name, the line number the debug function is called from and the 
actual debug message or the name of a supplied variable and it's 
value. The script should handle any type of variable and will, 
depending on the type identify, that variable's type.

`debug()` can accept any number of arguments. The value of each 
argument along with its variable name (if there is one) will be 
printed on a new line.


## Installation

To make `debug()` work all you need to do is include debug.inc.php in your script (preferably as early possible)

To get the most out of it, you should also have a copy of debug.info in the same directory/folder as the calling script (same directory as $_SERVER['SCRIPT_NAME'])

-----
	
## Basic usage

### Most common usage

The most comon usage for `debug()` is to output the value of a variable (at least that's how I mostly use it)

```php
$var1 = array( 'string', 123643, true );
define('CONST_1','this is a const');

debug($var1);debug(CONST_1);
```

This will output 

```html
<pre class="output">(my_script.php Line 231)
$var1 = Array
(
    [0] => 'string'
    [1] => 123643
    [2] => 1
)</pre>
<pre class="output">(my_script.php Line 231)
    CONST_1 = this is a const</pre>
```

> __Note:__ The variable (and constant) names are shown. 
> This relies on the finding an identical match for the variable's 
> (or constant's) value and type. Depending on your coding style it 
> may list all the possible variables (and/or constants) you have 
> assigned that value to. If there are a number of variables (or 
> constants) with identical values, it will list the names of all 
> them in order of assignment. This is particularly an issue if you 
> have a number of variables (or constants) with either an empty 
> string or boolean or NULL values.

> __NOTE:__ Because constants are global and PHP creates so many 
> when it starts (and because `debug()` itself creates a few of it's 
> own constants), this script excludes all constants created before 
> the end of debug.inc.php. This is so you don't end up with 10 or
> 20 constant names who's values also match PHP defined constants.
> If you are using constants (and even if you're not) you should
> include debug.inc.php as early as possible in the script.

	
### Normal usage

Often when debugging you just want to let yourself know you've reached a given point in the script and that something has happened. If you just want to output a string:

```php
debug('this is a debug message');
```
		
This will output
```html
<pre class="output">(my_script.php Line 231)
this is a debug message</pre>
```

### Simplest usage
	
Sometimes all you need to know is that the script has processed a 
given line. If that is the case just call `debug()` with no arguments.

```php
`debug()`;
```
		
This will output

```html
<pre class="output">(my_script.php Line 231)</pre>
```

-----
	
## Reserved strings
	
There are a number of reserved strings that if passed will cause 
`debug()` to do special things.

> __NOTE:__ these reserved strings are case insensitive.

* `help` or `?` - Outputs help documentation about the debug function
* `backtrace` - Outputs the contents of an array generated by 
  `debug_backtrace()`
* `server` - Outputs the contents of the $_SERVER global array
* `request` - Outputs the contents of the $_REQUEST global array
* `get` - Outputs the contents of the $_GET global array
* `post` - Outputs the contents of the $_POST global array
* `env` - Outputs the contents of the $_ENV global array
* `files` - Outputs the contents of the $_FILES global array
* `session` - Outputs the contents of the $_SESSION global array
* `cookie` - Outputs the contents of the $_COOKIE global array
* `globals` - Outputs the contents of the $GLOBALS global array 
  (will also accept global)
* `max_times=X` - defines the maximum number of times `debug()` will 
  be called within a given loop
  * (will also accept "max times = X", "maxtimes =X", "max-times X" 
    (__Note:__ spaces, hyphens and underscores can be used 
    inter-changably or omitted. equals can also be omitted)
  * (see [Advanced usage &gt; max_times for more info](#max_times))
* `force_die` - cause the debug function to kill the script after a given number of times (defined by max_times)
  * (will also accept 'force die', 'force-die', 'forcedie')
  * (see [Advanced usage &gt; force die for more info](#force_die))
* `config` - Outputs configuration info for `debug()`
  * (__NOTE:__ this has not been implemented yet so it will only tell you that it hasn't been implmented)

----- 

## Advanced usage
	
### Unlimited arguments
	
`debug()` can accept an unlimited number of arguments, in any order. Each supplied argument is handled individually (see [exception](#exception) and can be of any type.
	
As each argument is processed, it is checked for type and handled appropriately. Then output starting on a new line

```php
$var1 = array('string', 123643, true );
$var2 = 1234589.32;

debug($var1, 'server', 'post', 'This is a debug function call', $var2);
```
		
This will output

```html
<pre class="output">(my_script.php Line 231)
$var1 = Array
(
    [0] => string
    [1] => 123643
    [2] => 1
)

$_SERVER: Array
(
    [HTTP_HOST] => localhost
    [HTTP_USER_AGENT] => Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.2.12) Gecko/20101027 Ubuntu/10.04 (lucid) Firefox/3.6.12
    [HTTP_ACCEPT] => text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
    [HTTP_ACCEPT_LANGUAGE] => en-us,en;q=0.5
    [HTTP_ACCEPT_ENCODING] => gzip,deflate
    [HTTP_ACCEPT_CHARSET] => ISO-8859-1,utf-8;q=0.7,*;q=0.7
    [HTTP_KEEP_ALIVE] => 115
    [HTTP_CONNECTION] => keep-alive
    [HTTP_REFERER] => http://localhost/eNewsletter-prep/
    [HTTP_PRAGMA] => no-cache
    [HTTP_CACHE_CONTROL] => no-cache
    [CONTENT_TYPE] => application/x-www-form-urlencoded
    [CONTENT_LENGTH] => 101
    [PATH] => /usr/local/bin:/usr/bin:/bin
    [SERVER_SIGNATURE] => <address>Apache/2.2.14 (Ubuntu) Server at localhost Port 80</address>
    [SERVER_SOFTWARE] => Apache/2.2.14 (Ubuntu)
    [SERVER_NAME] => localhost
    [SERVER_ADDR] => ::1
    [SERVER_PORT] => 80
    [REMOTE_ADDR] => ::1
    [DOCUMENT_ROOT] => /var/www
    [SERVER_ADMIN] => webmaster@localhost
    [SCRIPT_FILENAME] => /var/www/eNewsletter-prep/index.php
    [REMOTE_PORT] => 51515
    [GATEWAY_INTERFACE] => CGI/1.1
    [SERVER_PROTOCOL] => HTTP/1.1
    [REQUEST_METHOD] => POST
    [QUERY_STRING] =>
    [REQUEST_URI] => /eNewsletter-prep/
    [SCRIPT_NAME] => /eNewsletter-prep/index.php
    [PHP_SELF] => /eNewsletter-prep/index.php
    [REQUEST_TIME] => 1290144742
)

$_POST: Array
(
    [template] => ACU_Update_2009
    [submit] => Prepare email
    [ga_source] =>
    [ga_medium] =>
    [ga_campaign] =>
    [ga_content] =>
    [ga_term] =>
)

This is a debug function call
$var2 = 1234589.32 (double)</pre>
```
	
### `max_times`
	
By calling debug('max_times=X'); from within a loop you cause that instance of `debug()` to output only the supplied number of times (or if no number is supplied, the default maximum number of times.
	
How does it do this you might ask without using global variables or objects. Well it does it by creating a constant for every time that instance of `debug()` is called until the maximum is reached.
	
You can have any number of max_times set, as they are independant.
	
The default for max_times is 100 but can be raised or lowerd via the debug.info config file (see more on <a href="#config">debug.info</a>)

	
### `force_die`

If your script is getting stuck in an infinite loop you can use debug('max_times=30','force_die') to kill the script after a given number calles to the `debug()` function from a specific line (in this case 30 times)<br />
__NOTE:__ this functionality has __not__ be exhaustively tested. In all my testing it has worked but...)
</p>
	
(__NOTE:__ force_die cannot work without max_times being defined in the same function call)

-----

## Configuration
	
By default `debug()` outputs directly to screen in HTML format but this can be over ridden by having a debug.info file in the same directory/folder as the script being run.

	
### Options

* `status`: Defines whether or not debug will output anything.
  * "`true`" *[default]* = Always show `debug()` output
  * "`false`" = Never show `debug()` output
  * "`debug`" = Only show `debug()` output if `$_GET['debug']` is set and equals "true".<br />
    (Useful for debugging live or production scripts)
* `format`: Defines how the debug output will be rendered
  * "`html`" = Format `debug()` output as HTML 
    (recommended if you're testing via a browser)
  * "`text`" = Format `debug()` output in plain text.<br />
    (Useful if you're testing from the command line or writing to a log file)
  * "`comment`" = Format `debug()` output as plain text but wrapped in HTML comments.<br />
    (Useful if you're debugging a live script and don't want people to see the inappropriate stuff)
  * "`auto`" = Debug output mode is set by calling context.<br />
    If called via HTTP, then output will be `html`.<br />
    If called via Command line, the output will be `text`
* `mode`: Defines where the output of debug is rendered. i.e. Is it 
   rendered to screen, to a log file or returned as a string for use 
   elsewhere?
	* "`echo`" *[default]* = Display `debug()` output to screen 
    (or terminal) (normal if 'format' is HTML or comment
	* "`return`" = Return `debug()` output as a string to be used elsewhere in your code
	* "`clean`" or "`log`" or "`log-clean`" = Write `debug()` output to an empty log file
  * "`append`" or "`log-append`" = Append `debug()` output to an existing log file
* `show_file`: Defines whether the name of the file 
  `debug()` is being called from is rendered in the debug output.
  * "`true`" *[default]* = Show name of file currently being processed 
    in debug output.<br />
    (Useful if you are working with a script with multiple inlcudes)
  * "`false`" = Never show current file name
* `show_date`: Defines whether the current date is rendered in the 
  debug output
  * "`false`" *[default]* = Never show today's date
  * "`true`" = Show today's date in `debug()` output.<br />
    (Useful if you've got other people testing a script and 
    you're writing debug output to a log file)
* `show_time`: Defines whether the time a `debug()` call is parsed 
  is rendered in the debug output.
	* "`false`" *[default]* = Never show the time `debug()` is called
	* "`true`" = Show the time in the `debug()` output.<br />
    (Useful if you're trying to work out where your script is slow 
    or if you're writing to log file)
* `full_path`: Defines whether the full path to the current file 
  being processed is rendered in the debug output.
  > __Note:__ This is only relevant if `show_file` is set to TRUE)
  * "`false`" *[default]* Never show full path for current file
  * "`true`" = Show full/absolute path to current file<br />
    (Useful if you're including php files outside the directory the original script is called from)
* `log_file`: log_file is the file name to output log to. 
  * `""` (empty string) If logging is active it defaults to 
  `.debug__log.[CALLING SCRIP'S NAME].log`
* `meta_max_length`: The maximum number of total characters the file 
  name, line number, date and time can be before the debug output is 
  pushed to a new line.
  * `40` *[defaut]*
* `max_max_times`: If the `max-times` option is passed for a particular 
  `debug()` call, `max_max_times` is the default maximum number of 
  times a that particular call to `debug()` will be rendered within 
  a loop.
  > __NOTE:__ If `force-die` is also passed, when the `max-times` is 
    reach the script will stop processing all together. This is 
    to help debug scripts with infinite loops.
  * `100` *[default]*

	
### Sample config file

```info
; debug info file - This file defines DEBUG config for the current app

; -----------------------------------------------
; status defines whether or not debug will output
; anything.
; The options are:
;    'true' (default) or 'on' or 'test' or 'testing' -
;          debug() will always be shown if called
;    'false' or 'off' - debug() will never be
;          shown
;    'debug' - debug() will only be shown if
;          $_GET['debug'] is set and equal to
;          TRUE or 'debug'

status = true;


; -----------------------------------------------
; format defines how the debug output will be
; written.
; The options are:
;     'html' - Use HTML to mark up the
;          debug output
;     'comment' - wrap the 'text' output in HTML
;           comment tags
;     'text' or 'log' - render the output of
;          debug() in plain text
;     'auto' (default) - if the parent script is
;          running from the command line, format
;          will become 'text', otherwise it will
;          become 'html'

format = auto; comment / html / log / text / auto


; -----------------------------------------------
; mode defines where the output of debug is
; rendered. i.e. is it rendered to screen, to a
; log file or returned as a string for use
; elsewhere.
; The options are:
;     'append' or 'log_append' - add to an
;          existing log file
;     'clean' or 'log' or 'log_clean' - add to an
;          empty log file
;     'echo' (default) - render to screen
;     'return' - returned by the debug function
 
mode = echo; append / clean / echo / log / log_append / log_clean / return


; -----------------------------------------------
; show_file defines whether the name of the file
; debug() is being called from is rendered in the
; debug output.
; The options are:
;     true (default) or false

show_file = true; true/false


; -----------------------------------------------
; show_date defines whether the current date is
; rendered in the debug output.
; The options are:
;     true or false (default)

show_date = false; true/false


; -----------------------------------------------
; show_time defines whether the time a debug()
; call is parsed is rendered in the debug output.
; The options are:
;     true or false (default)

show_time = false; true/false


; -----------------------------------------------
; full_path defines whether the full path to the
; current file being processed is rendered in the
; debug output.
; (Note: This is only relevant if show_file is
;  set to TRUE)
; The options are:
;     true or false (default)

full_path = false;


; -----------------------------------------------
; log_file is the file name to output log to. If
; logging is active it defaults to 
; .debug__log.[initial file name].log
;log_file = ;


; -----------------------------------------------
; time_adjust is the number of seconds (or minutes
; or hours) difference between the server time
; and your local time)

;time_adjust 36000; 10 hours


; -----------------------------------------------
; timezone string to be used by
; date_default_timezone_set()
; (see www.php.net/manual/en/timezones.php)
; default timezone is Australia/Sydney;
; NOTE: timezone is case sensitive

timezone = Australia/Sydney;


; -----------------------------------------------
; meta_max_length is the maximum number of total
; characters the file name, line number, date and
; time can be before the debug output is pushed
; to a new line.

meta_max_length = 10;


; -----------------------------------------------
; if the max-times option is passed for a
; particular debug() call, max_max_times is the
; default maximum number of times a that
; particular call to debug() will be rendered
; within a loop.
; NOTE: if force-die is also passed, when the
;       max-times is reach the script will stop
;       processing all together. This is to help
;       debug scripts with infinite loops.

max_max_times = 13;


```
